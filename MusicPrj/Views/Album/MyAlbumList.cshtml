@model IEnumerable<MusicPrj.tAlbum>
@using MusicPrj.Models;

@{
    ViewBag.Title = "MyAlbumList2";
    if (Request.IsAjaxRequest() == false)
    {
        Layout = "~/Views/Shared/_Layout.cshtml";
    }
    else
    {
        Layout = null;
    }
    int count = 0;
    var account = "";
    if (Session[CDictionary.SK_ACCOUNT] == null || string.IsNullOrWhiteSpace(Session[CDictionary.SK_ACCOUNT].ToString()))
    {
        Response.Redirect("~/Index/");
    }
    else
    {
        account = Session[CDictionary.SK_ACCOUNT].ToString();
    }
    tAlbum tA = new tAlbum();

}

<style>

    /*滑鼠拖曳選擇Kind效果css開始*/
    .containerDrag ul {
        width: 360px;
        padding: 15px;
        min-height: 300px;
        background-color: #FFFFF0;
        margin: 20px;
        display: block;
        float: left;
        border-radius: 5px;
        border: 1px solid #bbb;
    }

     .containerDrag ul li {
            display: block;
            float: left;
            width: 90px;
            height: 35px;
            line-height: 35px;
            border-radius: 4px;
            margin: 0;
            padding: 0;
            list-style: none;
            background-color: #EED2EE;
            margin-bottom: 10px;
            -moz-user-select: none;
            user-select: none;
            text-indent: 10px;
            color: #555;
            margin-right:10px
        }
     /*滑鼠拖曳選擇Kind效果css結束*/
     /*摺疊效果預設摺起來*/
    .foldAlbum {
        display: none;
        line-height: 17pt;
        width: 100%
    }
</style>


<div style="padding-left:50px;padding-top:50px">
    <h3 class="fold-title" data-playurl=""><i class="fa fa-chevron-right"></i> 新增專輯</h3>
    <div class="foldAlbum">
        <div class="fold-container">
            <div class="container" style="color:white">
                @*for start*@
                @using (Html.BeginForm("AddAlbum", "Album", FormMethod.Post, new { enctype = "multipart/form-data" }))
                {
                    @Html.AntiForgeryToken()

                <div class="form-horizontal">
                    <h4>請輸入專輯基本資料</h4>
                    <hr />
                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                    <div class="form-group">
                        @Html.LabelFor(model => tA.fAlbumName, htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-10">
                            @Html.EditorFor(model => tA.fAlbumName, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => tA.fAlbumName, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => tA.fMaker, htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-10">
                            @Html.EditorFor(model => tA.fMaker, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => tA.fMaker, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => tA.fYear, htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-10">
                            <input class="form-control text-box single-line" data-val="true" data-val-required="發行日必填" id="tA_fYear" name="tA.fYear" type="date" value="2020-01-01">
                            @Html.ValidationMessageFor(model => tA.fYear, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => tA.fType, htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-10">
                            @*@Html.EditorFor(model => tA.fType, new { htmlAttributes = new { @class = "form-control" } })*@
                            <select class="advancedtxt form-control" name="tA.fType" id="adTypePageload">
                                <option value="0">不指定</option>
                                @* 網頁初始化時會在這裡更新搜尋的類別 *@
                            </select>
                            @Html.ValidationMessageFor(model => tA.fType, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => tA.fALPrice, htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-10">
                            @Html.EditorFor(model => tA.fALPrice, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => tA.fALPrice, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    @*使用拖曳填入input的專輯Kind*@
                    <div class="form-group" style="min-height:400px">
                        @Html.LabelFor(model => tA.fKinds, htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-10">
                            <div class="containerDrag">
                                <ul id="userKindtaginput"></ul>
                                <ul id="adKindULPageload">
                                    <li>不指定</li>
                                </ul>
                            </div>
                            <hr />
                            @*input除錯用,平常type設成hide*@
                            <input class="form-control text-box single-line" id="tA_fKinds" name="tA.fKinds" type="text" value="">
                            @Html.ValidationMessageFor(model => tA.fKinds, "", new { @class = "text-danger" })
                        </div>
                    </div>
                    <script>
                        $(function () {
                            drag.init('containerDrag');
                        });
                    </script>

                    <div class="form-group">
                        @Html.LabelFor(model => tA.fCoverPath, htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-10" style="display:inline-block">
                            <input type="file" name="tA.fCoverRealFile" id="preview_fCoverRealFile_source" />
                        </div>
                        <div style="display:inline-block">
                            <img id="preview_fCoverRealFile" src="#" width="320" height="320" />
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => tA.fPublisher, htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-10">
                            @Html.EditorFor(model => tA.fPublisher, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => tA.fPublisher, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-offset-2 col-md-10">
                            <input type="submit" value="Create" class="btn btn-warning" />
                        </div>
                    </div>
                </div>
                }
                @*for end*@
            </div>
        </div>
    </div>
    <h1 class="headtitle">你的所有專輯</h1>
    <table>
        <tr>
            @*此處<tr>為自動依瀏覽器大小換欄*@
            @foreach (var item in Model)
            {
                count++;
                if (count % 7 == 1)
                {
                    //      @:<tr>
                }
                <td class="productitem">
                    <a href="~/Album/AlbumInfo?amid=@Html.DisplayFor(modelItem => item.fAlbumID)" class="productitemhy">
                        <fieldset style="border:1px solid;height:300px;border-radius:5px;padding:5px;">
                            <table>
                                <tr><td><img src="~/CoverFiles/@Html.DisplayFor(modelItem => item.fCoverPath)" width="200" height="200" /></td></tr>
                                <tr>
                                    <td>
                                        <div class="albumname" title="@Html.DisplayFor(modelItem => item.fAlbumName)">@Html.DisplayFor(modelItem => item.fAlbumName)</div>
                                    </td>
                                </tr>
                                <tr><td>@Html.DisplayFor(modelItem => item.fMaker)</td></tr>
                            </table>
                        </fieldset>

                    </a>
                </td>
                if (count % 7 == 0)
                {
                    //     @:</tr>
                }
            }
        </tr>
    </table>
</div>

<script>
    $("#preview_fCoverRealFile").css("display", "none");
            //摺疊
            $(function () {
            $('h3').click(function () {
                if ($(this).next('.foldAlbum').hasClass('o') == true) {
                    $(this).find('i.fa').removeClass('fa-chevron-down').addClass('fa-chevron-right');
                    $(this).next('.foldAlbum').removeClass('o').slideUp();
                }
                else {
                    $(this).find('i.fa').removeClass('fa-chevron-right').addClass('fa-chevron-down');
                    $(this).next('.foldAlbum').addClass('o').slideDown();
                }
            });
            });

            //圖片選擇按下時時重新載入
            $("#preview_fCoverRealFile_source").change(function(){
            readURL(this);
            });
            //類別選擇載入
            function readURL(input){

            if(input.files && input.files[0]){
            var reader = new FileReader();
            reader.onload = function (e) {
                $("#preview_fCoverRealFile").attr('src', e.target.result);
                $("#preview_fCoverRealFile").css("display", "inline");
                    }
                reader.readAsDataURL(input.files[0]);
                }
            }

                $.getJSON('@Url.Action("SetTypes","Search")', function (datas) {
                $.each(datas, function (name, value) {
                    $("#adTypePageload").append(`<option value="${value.fTypeID}">${value.fTypeName}</option>`)
                })
                })
                    $.getJSON('@Url.Action("SetKinds","Search")', function (datas) {
                $.each(datas, function (name, value) {
                    $("#adKindPageload").append(`<option value="${value.KindName}">${value.KindName}</option>`)
                    $("#adKindULPageload").append(`<li value="${value.KindName}">${value.KindName}</li>`)
                })
                    })
        //滑鼠拖動時取得拖曳內容轉成文字方塊
        $("#userKindtaginput").mouseout(function () {
        let kindtag = '';
        $("#userKindtaginput li").each(function () {
            kindtag += ""+$(this).text() + ',';
            console.log($(this).text());
        })
        $("#tA_fKinds").val(kindtag);
        })

        $("#adKindULPageload").mouseout(function () {
        let kindtag = '';
        $("#userKindtaginput li").each(function () {
            kindtag += ""+$(this).text() + ',';
        })
        $("#tA_fKinds").val(kindtag);
        })

</script>